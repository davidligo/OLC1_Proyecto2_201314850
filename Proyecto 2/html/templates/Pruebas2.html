<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    
</head>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">  </script>
<style>
div.editor {
  max-width:500px;
  max-height: 500px;
  margin: auto;
  position: relative;
  left: 30px;
}

</style>
<script>
  
</script>
<body>
    <input type="file" id="file"/>
    <!--<textarea id="contenido" rows="4" cols="30" style="width:500px;height:300px"></textarea> -->

    <div type="text" id="editor" class="editor">
    
    
    </div>
    <input type="button" id="submit" value="Analizar">

    <table>
      <thead>
        <tr>
          <th>No.</th>
          <th>Tipo Error</th>
          <th>Fila</th>
          <th>Columna</th>
          <th>Descripci√≥n</th>
        </tr>
      </thead>
      <tbody id="tablaErrores">

      </tbody>


    </table>

    
</body>
<script>

var editor2 = new Quill('#editor', {
  modules: {
    toolbar: false
  },
  theme: 'snow'  // or 'bubble'
});
    const input = document.getElementById('file');
    //const editor = document.getElementById('contenido');
    input.addEventListener('change', function () {
      if (input.files.length > 0) {
        //readFile(input.files[0]);
        readFile2(input.files[0]);
      }
    });
    
    /*function readFile(file) {
      const reader = new FileReader();
      reader.onload = function() {
        editor.value= reader.result; 
      }
      reader.readAsText(file);
    }*/
    function readFile2(file) {
      const reader = new FileReader();
      var tam = editor2.getLength();

      editor2.deleteText(0, tam);
      reader.onload = function() {
        editor2.insertText(0, reader.result, {
            'color': '#000000'
        });
      }
      reader.readAsText(file);
    }

    $(document).ready(function(){
    var texto;
    $("#submit").click(function(){
      var tam = editor2.getLength();
      texto = editor2.getText(0,tam);
      console.log(texto);
      $.post("http://localhost:3000/cargarArchivo",{texto: texto}, function(data){
        let respuesta = JSON.parse(data);
        
        editor2.deleteText(0, tam);
        editor2.insertText(0, respuesta.texto, {
            'color': '#000000'
        });
        let tablaErrores = document.querySelector('#tablaErrores');
        tablaErrores.innerHTML = '';
        let x = 1;
        for(let item of respuesta.listaErroresL){
          tablaErrores.innerHTML += `
          <th>${x}</th>
          <th>Lexico</th>
          <th>${item.fila }</th>
          <th>${item.columna}</th>
          <th>${item.descripcion}</th>
          `;
          console.log(x);
          x++;
        }
            alert(data);
          
      });
    });
  });
    </script>
</html>




